<!doctype html>
<html lang="en-GB">
  <head>
    <meta charset="UTF-8" />
    <title>Flock XR - Creative coding in 3D</title>
    <meta name="description" content="Flock XR: The free 3D coding and creation tool for young people.">
    <meta name="keywords" content="XR, Flock XR, 3D, coding, education, kids, beginners, teenagers, augmented reality, virtual reality, spatial computing, learn, beginner, creative coding, 3D art, 3D design, 3D programming, 3D games, 3D animation, 3D modeling, 3D printing, free">

    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"
    />

    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />

    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png" />
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
    <link rel="icon" href="/images/favicon.svg" type="image/svg+xml" />

    <meta name="theme-color" content="#511d91" />
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QCGT3X072N"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-QCGT3X072N', {
        'client_storage': 'none',  // Prevents setting cookies
        'anonymize_ip': true  // Hides IP addresses for privacy
      });
    </script>

    <link rel="stylesheet" href="style.css" />
    <style>
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Critical loading styles - inline to prevent flash */
      #flockeditor {
        opacity: 0 !important;
        pointer-events: none;
        visibility: hidden;
      }

      body:not(.loading) #flockeditor {
        opacity: 1 !important;
        pointer-events: auto;
        visibility: visible;
        transition: opacity 0.3s ease-in;
      }

      .loading-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        opacity: 1;
        transition: opacity 0.5s ease-out;
      }

      .loading-screen.fade-out {
        opacity: 0;
        pointer-events: none;
      }

      /* Inline critical bird styles for immediate loading */
      .loading-bird {
        width: 120px !important;
        height: 120px !important;
        max-width: 120px;
        max-height: 120px;
        animation: float 2s ease-in-out infinite;
        display: block;
        order: 1;
      }

      .loading-content {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
      }

      .loading-brand {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
        margin-bottom: 10px;
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      /* Inline critical loading text styles */
      .loading-text {
        color: #511D91 !important;
        font-size: 18px;
        font-weight: 500;
        margin: 0;
        font-family: "Atkinson Hyperlegible Next", "Asap", Helvetica, Arial, Lucida, sans-serif;
        order: 4;
      }

      .loading-logo {
        width: 200px;
        height: auto;
        margin: 10px 0;
        order: 2;
        opacity: 0;
        animation: fadeInLogo 0.5s ease-in 0.3s forwards;
      }

      @keyframes fadeInLogo {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid #e3e3e3;
        border-top: 4px solid #511D91;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        order: 3;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>

  <body class="loading">
    <script>
    (function(){
      const overlay = document.createElement('div');
      Object.assign(overlay.style, {
        position:'fixed', left:'0', bottom:'0', width:'100%', maxHeight:'45vh',
        overflowY:'auto', background:'rgba(0,0,0,.8)', color:'#0f0',
        font:'12px/1.4 monospace', padding:'8px', zIndex: 2147483647, display:'none'
      });
      document.addEventListener('touchstart', (e)=>{
        if (e.touches.length >= 3) overlay.style.display = (overlay.style.display==='none'?'block':'none');
      }, {passive:true});
      document.body.appendChild(overlay);

      const append = (tag, args) => {
        const line = document.createElement('div');
        line.textContent = `[${tag}] ` + args.map(a=>{
          try { return typeof a==='string'?a:JSON.stringify(a); }
          catch(_){ return String(a); }
        }).join(' ');
        overlay.appendChild(line);
        overlay.scrollTop = overlay.scrollHeight;
      };

      const orig = { log:console.log, warn:console.warn, error:console.error };
      console.log = (...a)=>{ append('log',a); orig.log.apply(console,a); };
      console.warn = (...a)=>{ append('warn',a); orig.warn.apply(console,a); };
      console.error = (...a)=>{ append('error',a); orig.error.apply(console,a); };

      window.addEventListener('error', e => append('uncaught', [e.message, e.filename+':'+e.lineno]));
      window.addEventListener('unhandledrejection', e => append('rejection', [String(e.reason)]));
    })();
    </script>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen" role="dialog" aria-modal="true" aria-labelledby="loading-title" aria-describedby="loading-description">
      <div class="loading-content">
        <img src="images/flock-bird-mascot.svg" alt="Flock XR Bird mascot" class="loading-bird" width="120" height="120" />
        <img src="images/inline-flock-xr.svg" alt="Flock XR Logo" class="loading-logo"/>
        <div class="loading-spinner" role="img" aria-label="Loading animation"></div>
        <h1 id="loading-title" class="sr-only">Loading Flock XR</h1>
        <p id="loading-description" data-i18n="loading" class="loading-text" aria-live="polite">Loading Flock XR...</p>
      </div>
    </div>

    <h1 class="sr-only">FlockXR</h1>
    <label for="importFile" class="sr-only">Import project file</label>
    <input
      type="file"
      id="importFile"
      style="display: none"
      accept=".json,.svg,.png"
    />

    <div id="flockeditor">
      <header role="banner">
        <nav id="menu" role="navigation" aria-label="Main navigation">
        <div id="menuleft">
          <img src="./images/flock-bird-mascot.svg" alt="Flock XR logo" id="logo" />
          <!-- Menu Button -->
          <!-- Added the menu wrapper for mobile screens and put about option when clicked shows the popup modal for the screen of the button show info inherently disabled the showinfo button on mobile screens-->
          <div id="main-menu">
              <button
                  class="bigbutton"
                  id="menuBtn"
                  title="Main menu"
                  aria-label="Main menu"
                  aria-expanded="false"
                  aria-haspopup="true"
              >
                  <span class="sr-only">Menu</span>
                  <div class="icon" style="width: 1.25em; height: 1.25em" aria-hidden="true">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="#511D91">
                          <path d="M0 96C0 78.3 14.3 64 32 64h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zm0 160c0-17.7 14.3-32 32-32h384c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zm448 160c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32h384c17.7 0 32-14.3 32 32z"/>
                      </svg>
                  </div>
              </button>

              <ul id="menuDropdown" class="dropdown hidden" role="menu" aria-labelledby="menuBtn">
                  <!-- Project menu item with submenu -->
                  <li
                      id="project-menu-item"
                      class="menu-item"
                      role="menuitem"
                      tabindex="-1"
                      aria-haspopup="true"
                      aria-expanded="false"
                      aria-controls="project-submenu"
                    aria-labelledby="project-label"
                  >
                      <span class="menu-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" aria-hidden="true">
                              <path d="M0 64C0 28.7 28.7 0 64 0L224 0l0 128c0 17.7 14.3 32 32 32l128 0 0 288c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64L0 64zm384 64l-128 0L256 0 384 128z"/>
                          </svg>
                      </span>
                    <span id="project-label" class="menu-label" data-i18n="project_submenu">Project</span>

                      <ul
                          id="project-submenu"
                          class="submenu"
                          role="menu"
                        aria-labelledby="project-menu-item"
                          hidden
                      >
                          <li><a href="#" id="project-new" data-i18n="project_new" role="menuitem" tabindex="-1">New</a></li>
                          <li><a href="#" id="project-open" data-i18n="project_open" role="menuitem" tabindex="-1">Open</a></li>
                          <li><a href="#" id="project-save" data-i18n="project_save" role="menuitem" tabindex="-1">Save</a></li>
                      </ul>
                  </li>

                  <!-- Language menu item with submenu -->
                  <li
                      id="language-menu-item"
                      class="menu-item"
                      role="menuitem"
                      tabindex="-1"
                      aria-haspopup="true"
                      aria-expanded="false"
                      aria-controls="language-submenu"
                     aria-labelledby="language-label"
                  >
                      <span class="menu-icon">
                          <svg
                              xmlns="http://www.w3.org/2000/svg"
                              viewBox="0 0 512 512"
                              style="width: 1.2em; height: 1.2em;"
                              aria-hidden="true"
                          >
                              <path d="M352 256c0 22.2-1.2 43.6-3.3 64l-185.3 0c-2.2-20.4-3.3-41.8-3.3-64s1.2-43.6 3.3-64l185.3 0c2.2 20.4 3.3 41.8 3.3 64zm28.8-64l123.1 0c5.3 20.5 8.1 41.9 8.1 64s-2.8 43.5-8.1 64l-123.1 0c2.1-20.6 3.2-42 3.2-64s-1.1-43.4-3.2-64zm112.6-32l-116.7 0c-10-63.9-29.8-117.4-55.3-151.6c78.3 20.7 142 77.5 171.9 151.6zm-149.1 0l-176.6 0c6.1-36.4 15.5-68.6 27-94.7c10.5-23.6 22.2-40.7 33.5-51.5C239.4 3.2 248.7 0 256 0s16.6 3.2 27.8 13.8c11.3 10.8 23 27.9 33.5 51.5c11.6 26 20.9 58.2 27 94.7zm-209 0L18.6 160C48.6 85.9 112.2 29.1 190.6 8.4C165.1 42.6 145.3 96.1 135.3 160zM8.1 192l123.1 0c-2.1 20.6-3.2 42-3.2 64s1.1 43.4 3.2 64L8.1 320C2.8 299.5 0 278.1 0 256s2.8-43.5 8.1-64zM194.7 446.6c-11.6-26-20.9-58.2-27-94.6l176.6 0c-6.1 36.4-15.5 68.6-27 94.6c-10.5 23.6-22.2 40.7-33.5 51.5C272.6 508.8 263.3 512 256 512s-16.6-3.2-27.8-13.8c-11.3-10.8-23-27.9-33.5-51.5zM135.3 352c10 63.9 29.8 117.4 55.3 151.6C112.2 482.9 48.6 426.1 18.6 352l116.7 0zm358.1 0c-30 74.1-93.6 130.9-171.9 151.6c25.5-34.2 45.2-87.7 55.3-151.6l116.7 0z"/>
                          </svg>
                      </span>
                    <span id="language-label" class="menu-label" data-i18n="language_submenu">Language</span>
                      <ul
                          id="language-submenu"
                          class="submenu"
                          role="menu"
                        aria-labelledby="language-menu-item"
                          hidden
                      >
                          <li><a href="#" data-lang="de" role="menuitem" tabindex="-1">Deutsch</a></li>
                          <li><a href="#" data-lang="en" role="menuitem" tabindex="-1">English</a></li>
                          <li><a href="#" data-lang="es" role="menuitem" tabindex="-1">Español</a></li>
                          <li><a href="#" data-lang="fr" role="menuitem" tabindex="-1">Français</a></li>
                          <li><a href="#" data-lang="pl" role="menuitem" tabindex="-1">Polski</a></li>
                          <li><a href="#" data-lang="pt" role="menuitem" tabindex="-1">Português</a></li>
                          <li><a href="#" data-lang="sv" role="menuitem" tabindex="-1">Svenska</a></li>
                      </ul>
                  </li>
                <li
                  id="theme-menu-item"
                  class="menu-item"
                  role="menuitem"
                  tabindex="-1"
                  aria-haspopup="true"
                  aria-expanded="false"
                  aria-controls="theme-submenu"
                   aria-labelledby="theme-label"
                >
                  <span class="menu-icon">
                     <svg  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" aria-hidden="true" ><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M339.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L568.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S517.7-4.4 499.1 9.6L262.4 187.2c-24 18-38.2 46.1-38.4 76.1L339.3 367.1zm-19.6 25.4l-116-104.4C143.9 290.3 96 339.6 96 400c0 3.9 .2 7.8 .6 11.6C98.4 429.1 86.4 448 68.8 448L64 448c-17.7 0-32 14.3-32 32s14.3 32 32 32l144 0c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg>
                  </span>
                   <span id="theme-label" class="menu-label" data-i18n="theme_submenu">Theme</span>
                  <ul
                      id="theme-submenu"
                      class="submenu"
                      role="menu"
                    aria-labelledby="theme-menu-item"
                      hidden
                  >
                      <li><a href="#" data-theme-target="light" data-i18n="light_theme" role="menuitem" tabindex="-1" class="active-theme">Light</a></li>
                      <li><a href="#" data-theme-target="dark" data-i18n="dark_theme" role="menuitem" tabindex="-1">Dark</a></li>
                      <li><a href="#" data-theme-target="dark-contrast" data-i18n="dark_contrast_theme" role="menuitem" tabindex="-1">Dark (High Contrast)</a></li>
                      <!--li><a href="#" data-theme-target="contrast" data-i18n="contrast_theme" role="menuitem" tabindex="-1">Contrast</a></li-->
                  </ul>
                </li>
                  <!-- About menu item -->
                  <li
                      id="about-menu-item"
                      class="menu-item"
                      role="menuitem"
                      tabindex="-1"
                  >
                      <span class="menu-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 1.2em; height: 1.2em;" aria-hidden="true">
                              <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/>
                          </svg>
                      </span>
                      <span class="menu-label" data-i18n="about_submenu">About</span>
                  </li>
              </ul>
          </div>
          <div id="infoModal" class="modal hidden" role="dialog" aria-labelledby="modal-title" aria-modal="true">
            <div class="modal-content" tabindex="-1">
              <span class="close-button" id="closeInfoModal" aria-label="Close information modal">&times;</span>
              <h2 id="modal-title" data-i18n="about_heading" style="margin-top: 0;">About Flock XR</h2>

              <div id="model-panel-content">
              <p data-i18n="about_description">
                Flock XR is a <strong>prototype</strong> made by
                <a target="_blank" href="https://flipcomputing.com/flockxr/"
                  >Flip Computing</a
                >. Please try it out but be aware that things may change and
                some features aren't finished yet. We're currently looking for
                support to develop Flock so that you can rely on it.
              </p>
              <div data-i18n="about_run">
                Take a look at the demos above to see what you can do.
                Make some changes and click
                <div
                  style="
                    display: inline-block;
                    margin-left: 2px;
                    margin-right: 2px;
                  "
                >
                  <div
                    class="icon"
                    style="height: 1em; width: 1em; padding: 0px"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 512 512"
                    >
                      <path
                        fill="#511D91"
                        d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c-7.6 4.2-12.3 12.3-12.3 20.9l0 176c0 8.7 4.7 16.7 12.3 20.9s16.8 4.1 24.3-.5l144-88c7.1-4.4 11.5-12.1 11.5-20.5s-4.4-16.1-11.5-20.5l-144-88c-7.4-4.5-16.7-4.7-24.3-.5z"
                      />
                    </svg>
                  </div>
                </div>
                run.
              </div>
              <p>      
              </p>
              <p data-i18n="about_links">View the <a target="_blank" href="https://flockxr.com/privacy-policy/">privacy policy</a> for Flock XR. <a href="https://flipcomputing.com/contact/" target="_blank"
                >Get in touch</a
              ></p>
              </div>
            </div>
          </div>
          <script>
            const menuBtn = document.getElementById("menuBtn");
            const menuDropdown = document.getElementById("menuDropdown");
            const openAbout = document.getElementById("about-menu-item");
            const infoModal = document.getElementById("infoModal");
            const closeInfoModal = document.getElementById("closeInfoModal");
          

            class AccessibleFlyoutMenu {
                constructor() {
                    this.menuButton = document.getElementById('menuBtn');
                    this.menuDropdown = document.getElementById('menuDropdown');
                    this.menuItems = this.menuDropdown.querySelectorAll('.menu-item');
                    this.isMenuOpen = false;
                    this.currentFocus = -1;
                    this.currentOpenSubmenu = null;

                    this.init();
                }

                init() {
                    // Main menu button events
                    this.menuButton.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.toggleMainMenu();
                    });

                    this.menuButton.addEventListener('keydown', (e) => {
                        if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            this.openMainMenu();
                            this.focusFirstMenuItem();
                        }
                    });

                    // Menu item events
                    this.menuItems.forEach((item, index) => {
                        // Mouse events (preserve existing functionality)
                        item.addEventListener('mouseenter', () => {
                            this.handleMouseEnter(item);
                        });

                        item.addEventListener('mouseleave', () => {
                            this.handleMouseLeave(item);
                        });

                        // Keyboard events
                        item.addEventListener('keydown', (e) => {
                            this.handleMenuItemKeydown(e, item, index);
                        });

                        item.addEventListener('click', (e) => {
                            this.handleMenuItemClick(e, item);
                        });

                        // Submenu events
                        const submenu = item.querySelector('.submenu');
                        if (submenu) {
                            const submenuItems = submenu.querySelectorAll('a');
                            submenuItems.forEach((subItem, subIndex) => {
                                subItem.addEventListener('keydown', (e) => {
                                    this.handleSubmenuKeydown(e, subItem, submenuItems, subIndex, item);
                                });

                                subItem.addEventListener('click', (e) => {
                                    console.log(`Clicked: ${subItem.textContent}`);
                                    this.closeAllMenus();
                                });
                            });
                        }
                    });

                    // Close menu when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!this.menuButton.contains(e.target) && !this.menuDropdown.contains(e.target)) {
                            this.closeAllMenus();
                        }
                    });

                    // Close menu on Escape
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'Escape' && this.isMenuOpen) {
                            this.closeAllMenus();
                            this.menuButton.focus();
                        }
                    });
                }

                toggleMainMenu() {
                    if (this.isMenuOpen) {
                        this.closeAllMenus();
                    } else {
                        this.openMainMenu();
                    }
                }

                openMainMenu() {
                    this.isMenuOpen = true;
                    this.menuDropdown.classList.remove('hidden');
                    this.menuButton.setAttribute('aria-expanded', 'true');
                    this.currentFocus = -1;
                }

                closeAllMenus() {
                    this.isMenuOpen = false;
                    this.menuDropdown.classList.add('hidden');
                    this.menuButton.setAttribute('aria-expanded', 'false');
                    this.closeAllSubmenus();
                    this.currentFocus = -1;
                }

                closeAllSubmenus() {
                    this.menuItems.forEach(item => {
                        const submenu = item.querySelector('.submenu');
                        if (submenu) {
                            submenu.hidden = true;
                            item.setAttribute('aria-expanded', 'false');
                        }
                    });
                    this.currentOpenSubmenu = null;
                }

                focusFirstMenuItem() {
                    this.currentFocus = 0;
                    this.menuItems[0].focus();
                }

                focusMenuItem(index) {
                    if (index >= 0 && index < this.menuItems.length) {
                        this.currentFocus = index;
                        this.menuItems[index].focus();
                    }
                }

                handleMouseEnter(item) {
                    // Close other submenus
                    this.closeAllSubmenus();

                    // Open this submenu if it has one
                    const submenu = item.querySelector('.submenu');
                    if (submenu) {
                        submenu.hidden = false;
                        item.setAttribute('aria-expanded', 'true');
                        this.currentOpenSubmenu = item;
                    }
                }

                handleMouseLeave(item) {
                    // Keep submenu open for keyboard navigation
                    // Only close on mouse leave from the entire menu area
                }

                handleMenuItemClick(e, item) {
                    const submenu = item.querySelector('.submenu');
                    if (submenu) {
                        e.preventDefault();
                        this.toggleSubmenu(item);
                    } else {
                        // For leaf menu items (like "About"), trigger the actual click event
                        // This will fire any existing click handlers you have attached
                        if (e.type === 'keydown') {
                            // If this was triggered by keyboard, create a synthetic click event
                            const clickEvent = new MouseEvent('click', {
                                bubbles: true,
                                cancelable: true
                            });
                            item.dispatchEvent(clickEvent);
                        }
                        this.closeAllMenus();
                    }
                }

                toggleSubmenu(item) {
                    const submenu = item.querySelector('.submenu');
                    const isOpen = !submenu.hidden;

                    this.closeAllSubmenus();

                    if (!isOpen) {
                        submenu.hidden = false;
                        item.setAttribute('aria-expanded', 'true');
                        this.currentOpenSubmenu = item;
                    }
                }

                handleMenuItemKeydown(e, item, index) {
                    const submenu = item.querySelector('.submenu');

                    switch (e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            this.focusMenuItem((index + 1) % this.menuItems.length);
                            break;

                        case 'ArrowUp':
                            e.preventDefault();
                            this.focusMenuItem(index === 0 ? this.menuItems.length - 1 : index - 1);
                            break;

                        case 'ArrowRight':
                            if (submenu) {
                                e.preventDefault();
                                this.showSubmenu(item);
                                const firstSubmenuItem = submenu.querySelector('a');
                                if (firstSubmenuItem) {
                                    firstSubmenuItem.focus();
                                }
                            }
                            break;

                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            this.handleMenuItemClick(e, item);
                            break;

                        case 'Escape':
                            this.closeAllMenus();
                            this.menuButton.focus();
                            break;
                    }
                }

                showSubmenu(item) {
                    this.closeAllSubmenus();
                    const submenu = item.querySelector('.submenu');
                    if (submenu) {
                        submenu.hidden = false;
                        item.setAttribute('aria-expanded', 'true');
                        this.currentOpenSubmenu = item;
                    }
                }

                handleSubmenuKeydown(e, subItem, submenuItems, subIndex, parentItem) {
                    switch (e.key) {
                        case 'ArrowDown':
                            e.preventDefault();
                            e.stopPropagation();
                            const nextIndex = (subIndex + 1) % submenuItems.length;
                            submenuItems[nextIndex].focus();
                            break;

                        case 'ArrowUp':
                            e.preventDefault();
                            e.stopPropagation();
                            const prevIndex = subIndex === 0 ? submenuItems.length - 1 : subIndex - 1;
                            submenuItems[prevIndex].focus();
                            break;

                        case 'ArrowLeft':
                            e.preventDefault();
                            e.stopPropagation();
                            parentItem.focus();
                            const submenu = parentItem.querySelector('.submenu');
                            if (submenu) {
                                submenu.hidden = true;
                                parentItem.setAttribute('aria-expanded', 'false');
                            }
                            break;

                        case 'Enter':
                        case ' ':
                            e.preventDefault();
                            e.stopPropagation();
                            subItem.click();
                            break;

                        case 'Escape':
                            e.preventDefault();
                            e.stopPropagation();
                            this.closeAllMenus();
                            this.menuButton.focus();
                            break;
                    }
                }
            }

            // Initialize the menu when DOM is loaded
            document.addEventListener('DOMContentLoaded', () => {
                new AccessibleFlyoutMenu();
            });

            // Handle keyboard navigation within dropdown
            openAbout.addEventListener("keydown", (e) => {
              if (e.key === "Escape") {
                e.preventDefault();
                menuDropdown.classList.add("hidden");
                menuBtn.setAttribute("aria-expanded", "false");
                menuBtn.focus();
              } 
            });

            // Language menu interactions are now handled in main/translation.js

            // Open modal when About is clicked
            openAbout.addEventListener("click", (e) => {
              e.preventDefault();
              previouslyFocused = document.activeElement;
              infoModal.classList.remove("hidden");
              menuDropdown.classList.add("hidden");
              menuBtn.setAttribute("aria-expanded", "false");

              // Focus the close button in the modal
              setTimeout(() => closeInfoModal.focus(), 0);
            });

            // Close modal on close button
            closeInfoModal.addEventListener("click", () => {
              infoModal.classList.add("hidden");
              if (previouslyFocused) {
                previouslyFocused.focus();
                previouslyFocused = null;
              }
            });

            // Handle keyboard events for modal
            infoModal.addEventListener("keydown", (e) => {
              if (e.key === "Escape") {
                e.preventDefault();
                closeInfoModal.click();
              } else if (e.key === "Tab") {
                // Trap focus within modal
                const focusableElements = infoModal.querySelectorAll(
                  'button, input, select, textarea, [href], [tabindex]:not([tabindex="-1"])'
                );
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                  e.preventDefault();
                  lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                  e.preventDefault();
                  firstElement.focus();
                }
              }
            });

            // Close menu when clicking outside
            window.addEventListener("click", (e) => {
              if (!menuBtn.contains(e.target) && !menuDropdown.contains(e.target)) {
                menuDropdown.classList.add("hidden");
                menuBtn.setAttribute("aria-expanded", "false");
              }

              if (e.target === infoModal) {
                closeInfoModal.click();
              }
            });

            // Close menu on Escape key
            document.addEventListener("keydown", (e) => {
              if (e.key === "Escape" && !menuDropdown.classList.contains("hidden")) {
                menuDropdown.classList.add("hidden");
                menuBtn.setAttribute("aria-expanded", "false");
                menuBtn.focus();
              }
            });
          </script>
          <button class="bigbutton" id="runCodeButton" data-i18n="run_code_button" title="Run your code" aria-label="Run your code">
            <div class="icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24">
                <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path
                  fill="#511D91"
                  d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c-7.6 4.2-12.3 12.3-12.3 20.9l0 176c0 8.7 4.7 16.7 12.3 20.9s16.8 4.1 24.3-.5l144-88c7.1-4.4 11.5-12.1 11.5-20.5s-4.4-16.1-11.5-20.5l-144-88c-7.4-4.5-16.7-4.7-24.3-.5z"
                />
              </svg>
            </div>
          </button>
          <button class="bigbutton" id="stopCodeButton" data-i18n="stop_code_button" title="Stop your code" aria-label="Stop your code">
            <div class="icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="24" height="24">
                <!--!Font Awesome Free 6.7.2  by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path
                  fill="#511D91"
                  d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM192 160l128 0c17.7 0 32 14.3 32 32l0 128c0 17.7-14.3 32-32 32l-128 0c-17.7 0-32-14.3-32-32l0-128c0-17.7 14.3-32 32-32z"
                />
              </svg>
            </div>
          </button>
          <button
            class="bigbutton"
            id="openButton"
            data-i18n="open_button"
            title="Open a project from a file on your computer"
            aria-label="Open a project from a file on your computer"
            tabindex="0"
          >
            <label for="fileInput" class="sr-only">Select project file to open</label>
            <input type="file" id="fileInput" style="display: none" disabled />
            <div class="icon" style="width: 1.25em; height: 1.25em" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free v6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M288 109.3L288 352c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-242.7-73.4 73.4c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l128-128c12.5-12.5 32.8-12.5 45.3 0l128 128c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L288 109.3zM64 352l128 0c0 35.3 28.7 64 64 64s64-28.7 64-64l128 0c35.3 0 64 28.7 64 64l0 32c0 35.3-28.7 64-64 64L64 512c-35.3 0-64-28.7-64-64l0-32c0-35.3 28.7-64 64-64zM432 456a24 24 0 1 0 0-48 24 24 0 1 0 0 48z"/></svg>
            </div>
          </button>
          <label for="projectName" class="sr-only">Project name</label>
          <input
            type="text"
            style="
              flex-shrink: 1;
              width: 100%;
              min-width: 10px;
              max-width: 80px;
            "
            id="projectName"
            data-i18n="project_name"
            placeholder="Project name"
            aria-describedby="project-name-desc"
          />
          <div id="project-name-desc" class="sr-only">Enter a name for your project to use when saving or exporting</div>
          <button
            class="bigbutton"
            id="exportCodeButton"
            data-i18n="export_code_button"
            title="Save this project to a file on your computer."
            aria-label="Save this project to a file on your computer"
            aria-describedby="export-desc"
          >
            <div class="icon" style="width: 1.25em; height: 1.25em" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path
                fill = "#511D91"
                d="M288 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 242.7-73.4-73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l128 128c12.5 12.5 32.8 12.5 45.3 0l128-128c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L288 274.7 288 32zM64 352c-35.3 0-64 28.7-64 64l0 32c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-32c0-35.3-28.7-64-64-64l-101.5 0-45.3 45.3c-25 25-65.5 25-90.5 0L165.5 352 64 352zm368 56a24 24 0 1 1 0 48 24 24 0 1 1 0-48z"
                />
              </svg>
            </div>
          </button>
          <div id="export-desc" class="sr-only">Downloads your project as a JSON file to your computer</div>
          <select
            id="exampleSelect"
            class="bigbutton"
            data-i18n="example_select"
            title="Choose an example project to load."
            style="font-size: 14px"
            disabled
            aria-label="Choose an example project to load"
            aria-describedby="demo-desc"
          >
            <option value="" data-i18n="demo" style="color: #511d91">Demo</option>
            <option id="new" data-i18n="new" value="examples/new.json">New</option>
            <option data-i18n="starter" value="examples/starter.json">👋🏽 Starter</option>
            <option data-i18n="controller_starter" value="examples/controller_starter.json">🎮 Controller Starter</option>
            <option data-i18n="snow_globe" value="examples/snow_globe.json">❄️ Snow globe</option>
            <option data-i18n="forest_base" value="examples/forest_base.json">🌲 Forest Base</option>
            <option data-i18n="character_animation" value="examples/character_animation.json">🎥 Character Animation</option>
            <option data-i18n="cube_art" value="examples/cube_art.json">🎨 Cube Art</option>
            <option data-i18n="physics_fun" value="examples/physics_fun.json">👆🏾 Physics Fun</option>
            <option data-i18n="collect_the_gems" value="examples/collect_the_gems.json">💎 Collect the Gems</option>
            <option data-i18n="water_map" value="examples/water_map.json">💧 Water Map</option>
            <option data-i18n="skittles" value="examples/skittles.json">🎳 Skittles</option>
            <option data-i18n="beetle" value="examples/beetle.json">🪲 Beetle</option>
            <option data-i18n="roominator" value="examples/roominator.json">🛋️ Roominator</option>
             <option data-i18n="sit_down" value="examples/sit_down.json">🪑 Sit Down</option>
            <option data-i18n="ball_pit" value="examples/ball_pit.json">🟠 Ball Pit</option>
            <option data-i18n="ur_enough" value="examples/ur_enough.json">💗 UR Enough!</option>
            <option data-i18n="tallest_buildings" value="examples/tallest_buildings.json">📊 Tallest buildings</option>
            <option data-i18n="candy_dash" value="examples/candy_dash.json">🎃 Candy dash</option>
            <option data-i18n="flockenspiel" value="examples/flockenspiel.json">🎵 Flockenspiel</option>
            <option data-i18n="pendant" value="examples/pendant.json">📿 3D-printable pendant</option>
            <option data-i18n="tent_lights" value="examples/tent_lights.json">⛺ Festival tent</option>
            <option data-i18n="my_place" value="examples/my_place.json">🏠 My place</option>
            <option data-i18n="microbit_monkey" value="examples/microbit_monkey.json">🐵 micro:bit monkey</option>
          </select>
          <div id="demo-desc" class="sr-only">Select from pre-built example projects to explore different features and capabilities</div>
        </div>
        
        <div id="menuright">
          <button
            class="bigbutton"
            id="toggleDesign"
            data-i18n="toggle_design"
            title="Design your project"
            aria-label="Switch to design mode"
            aria-describedby="design-desc"
            aria-pressed="false"
          >
            <div class="icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path
                  fill="#511D91"
                  d="M0 96C0 60.7 28.7 32 64 32l384 0c35.3 0 64 28.7 64 64l0 320c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 96zM323.8 202.5c-4.5-6.6-11.9-10.5-19.8-10.5s-15.4 3.9-19.8 10.5l-87 127.6L170.7 297c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4s12.4 13.6 21.6 13.6l96 0 32 0 208 0c8.9 0 17.1-4.9 21.2-12.8s3.6-17.4-1.4-24.7l-120-176zM112 192a48 48 0 1 0 0-96 48 48 0 1 0 0 96z"
                />
              </svg>
            </div>
          </button>
          <div id="design-desc" class="sr-only">Toggle design mode to visually create and modify 3D objects in your scene</div>
          <button class="bigbutton" id="togglePlay" data-i18n="toggle_play" title="Use your project" aria-label="Switch to play mode" aria-describedby="play-desc" aria-pressed="false">
            <div class="icon" style="width: 2em" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path
                  fill="#511D91"
                  d="M192 64C86 64 0 150 0 256S86 448 192 448l256 0c106 0 192-86 192-192s-86-192-192-192L192 64zM496 168a40 40 0 1 1 0 80 40 40 0 1 1 0-80zM392 304a40 40 0 1 1 80 0 40 40 0 1 1 -80 0zM168 200c0-13.3 10.7-24 24-24s24 10.7 24 24l0 32 32 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-32 0 0 32c0 13.3-10.7 24-24 24s-24-10.7-24-24l0-32-32 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l32 0 0-32z"
                />
              </svg>
            </div>
          </button>
          <div id="play-desc" class="sr-only">Toggle play mode to interact with and test your 3D project</div>
          <button
            class="bigbutton"
            title="Switch between fullscreen and normal views."
            id="fullscreenToggle"
            data-i18n="fullscreen_toggle"
            aria-label="Toggle fullscreen mode"
            aria-describedby="fullscreen-desc"
          >
            <div class="icon" aria-hidden="true">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
                <path
                  fill="#511D91"
                  d="M200 32L56 32C42.7 32 32 42.7 32 56l0 144c0 9.7 5.8 18.5 14.8 22.2s19.3 1.7 26.2-5.2l40-40 79 79-79 79L73 295c-6.9-6.9-17.2-8.9-26.2-5.2S32 302.3 32 312l0 144c0 13.3 10.7 24 24 24l144 0c9.7 0 18.5-5.8 22.2-14.8s1.7-19.3-5.2-26.2l-40-40 79-79 79 79-40 40c-6.9 6.9-8.9 17.2-5.2 26.2s12.5 14.8 22.2 14.8l144 0c13.3 0 24-10.7 24-24l0-144c0-9.7-5.8-18.5-14.8-22.2s-19.3-1.7-26.2 5.2l-40 40-79-79 79-79 40 40c6.9 6.9 17.2 8.9 26.2 5.2s14.8-12.5 14.8-22.2l0-144c0-13.3-10.7-24-24-24L312 32c-9.7 0-18.5 5.8-22.2 14.8s-1.7 19.3 5.2 26.2l40 40-79 79-79-79 40-40c6.9-6.9 8.9-17.2 5.2-26.2S209.7 32 200 32z"
                />
              </svg>
            </div>
          </button>
        </div>
      </nav>
      </header>
      <main role="main">
        <div id="maincontent" aria-label="Main content area" tabindex="0">
        <section id="canvasArea" aria-label="Canvas and design tools" >
          <canvas id="renderCanvas" touch-action="none" tabindex="0" aria-label="3D scene canvas" role="application" aria-describedby="canvas-desc canvas-controls-desc"></canvas>
          <div id="canvas-desc" class="sr-only">Interactive 3D scene where your project runs. Use keyboard controls to navigate and interact with objects.</div>
          <div id="canvas-controls-desc" class="sr-only">Canvas keyboard controls: Arrow keys or WASD to move camera, Mouse to look around, Space for actions, Tab to navigate to other interface elements.</div>
          <div id="fullscreen-desc" class="sr-only">Toggle between fullscreen and windowed view of the application</div>
          <aside class="gizmo-buttons" id="gizmoButtons" aria-label="Design tools">
            <div id="shape-menu">
              <!-- Gizmo button to toggle the shape menu -->
              <button
                class="gizmo-button"
                id="showShapesButton"
                data-i18n="show_shapes_button"
                style="margin-left: 5px"
                disabled
                aria-label="Add shapes and models"
                title="Add shapes and models"
                aria-expanded="false"
                aria-haspopup="true"
              >
                <!-- <img
                  src="./images/add.svg"
                  width="20px"
                  height="20px"
                  alt="Add"
                  onerror="this.style.display='none'; this.parentNode.textContent='+';"
                /> -->
                <?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="122.875px" height="122.648px" viewBox="0 0 122.875 122.648" enable-background="new 0 0 122.875 122.648" xml:space="preserve"><g><path fill="#fff" fill-rule="evenodd" clip-rule="evenodd" d="M108.993,47.079c7.683-0.059,13.898,6.12,13.882,13.805 c-0.018,7.683-6.26,13.959-13.942,14.019L75.24,75.138l-0.235,33.73c-0.063,7.619-6.338,13.789-14.014,13.78 c-7.678-0.01-13.848-6.197-13.785-13.818l0.233-33.497l-33.558,0.235C6.2,75.628-0.016,69.448,0,61.764 c0.018-7.683,6.261-13.959,13.943-14.018l33.692-0.236l0.236-33.73C47.935,6.161,54.209-0.009,61.885,0 c7.678,0.009,13.848,6.197,13.784,13.818l-0.233,33.497L108.993,47.079L108.993,47.079z"/></g></svg>
              </button>

              <!-- Dropdown for shapes and models -->
              <span id="shapes-dropdown" style="display: none">
                <!-- Shape Row -->
                <ul id="shape-row">
                  <li>
                    <button onclick="selectShape('create_box')" aria-label="Create box shape">
                      <img src="./images/box.png" alt="Box" />
                    </button>
                  </li>
                  <li>
                    <button onclick="selectShape('create_sphere')" aria-label="Create sphere shape">
                      <img src="./images/sphere.png" alt="Sphere" />
                    </button>
                  </li>
                  <li>
                    <button onclick="selectShape('create_cylinder')" aria-label="Create cylinder shape">
                      <img src="./images/cylinder.png" alt="Cylinder" />
                    </button>
                  </li>
                  <li>
                    <button onclick="selectShape('create_capsule')" aria-label="Create capsule shape">
                      <img src="./images/capsule.png" alt="Capsule" />
                    </button>
                  </li>
                  <li>
                    <button onclick="selectShape('create_plane')" aria-label="Create plane shape">
                      <img src="./images/plane.png" alt="Plane" />
                    </button>
                  </li>
                </ul>
                <!-- Model Row with scroll buttons -->
                <div class="scrollable-container">
                  <button
                    class="scroll-button left"
                    id="scrollModelsLeftButton"
                    disabled
                    aria-label="Scroll models left"
                  >
                    &Lang;
                  </button>
                  <ul id="model-row">
                    <!-- Dynamically generated model items will be inserted here -->
                  </ul>
                  <button
                    class="scroll-button right"
                    id="scrollModelsRightButton"
                    disabled
                    aria-label="Scroll models right"
                  >
                    &Rang;
                  </button>
                </div>
                <!-- Object Row -->
                <div class="scrollable-container">
                  <button
                    class="scroll-button left"
                    id="scrollObjectsLeftButton"
                    disabled
                    aria-label="Scroll objects left"
                  >
                    &Lang;
                  </button>
                  <ul id="object-row">
                    <!-- Dynamically generated object items will be inserted here -->
                  </ul>
                  <button
                    class="scroll-button right"
                    id="scrollObjectsRightButton"
                    disabled
                    aria-label="Scroll objects right"
                  >
                    &Rang;
                  </button>
                </div>
                <!-- Character Row -->
                <div class="scrollable-container">
                  <button
                    class="scroll-button left"
                    id="scrollCharactersLeftButton"
                    disabled
                    aria-label="Scroll characters left"
                  >
                    &Lang;
                  </button>
                  <ul id="character-row">
                    <!-- Dynamically generated character items will be inserted here -->
                  </ul>
                  <button
                    class="scroll-button right"
                    id="scrollCharactersRightButton"
                    disabled
                    aria-label="Scroll characters right"
                  >
                    &Rang;
                  </button>
                </div>
              </span>
            </div>
            <button class="gizmo-button" id="colorPickerButton" data-i18n="color_picker_button" aria-label="Choose a color" title="Choose a color">
              <!-- <img
                src="./images/looks.svg"
                width="20px"
                height="20px"
                alt="Color"
                onerror="this.style.display='none'; this.parentNode.textContent='🎨';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M512 256c0 .9 0 1.8 0 2.7c-.4 36.5-33.6 61.3-70.1 61.3L344 320c-26.5 0-48 21.5-48 48c0 3.4 .4 6.7 1 9.9c2.1 10.2 6.5 20 10.8 29.9c6.1 13.8 12.1 27.5 12.1 42c0 31.8-21.6 60.7-53.4 62c-3.5 .1-7 .2-10.6 .2C114.6 512 0 397.4 0 256S114.6 0 256 0S512 114.6 512 256zM128 288a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm0-96a32 32 0 1 0 0-64 32 32 0 1 0 0 64zM288 96a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm96 96a32 32 0 1 0 0-64 32 32 0 1 0 0 64z"/></svg>
            </button>
            <button class="gizmo-button" id="positionButton" data-i18n="position_button" disabled aria-label="Position mesh" title="Position mesh">
              <!-- <img
                src="./images/position.svg"
                width="20px"
                height="20px"
                alt="Position"
                onerror="this.style.display='none'; this.parentNode.textContent='⌖';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M278.6 9.4c-12.5-12.5-32.8-12.5-45.3 0l-64 64c-9.2 9.2-11.9 22.9-6.9 34.9s16.6 19.8 29.6 19.8l32 0 0 96-96 0 0-32c0-12.9-7.8-24.6-19.8-29.6s-25.7-2.2-34.9 6.9l-64 64c-12.5 12.5-12.5 32.8 0 45.3l64 64c9.2 9.2 22.9 11.9 34.9 6.9s19.8-16.6 19.8-29.6l0-32 96 0 0 96-32 0c-12.9 0-24.6 7.8-29.6 19.8s-2.2 25.7 6.9 34.9l64 64c12.5 12.5 32.8 12.5 45.3 0l64-64c9.2-9.2 11.9-22.9 6.9-34.9s-16.6-19.8-29.6-19.8l-32 0 0-96 96 0 0 32c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l64-64c12.5-12.5 12.5-32.8 0-45.3l-64-64c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 32-96 0 0-96 32 0c12.9 0 24.6-7.8 29.6-19.8s2.2-25.7-6.9-34.9l-64-64z"/></svg>
            </button>
            <button class="gizmo-button" id="rotationButton" data-i18n="rotation_button" disabled aria-label="Rotate mesh" title="Rotate mesh">
              <!-- <img
                src="./images/rotate.svg"
                width="20px"
                height="20px"
                alt="Rotate"
                onerror="this.style.display='none'; this.parentNode.textContent='↻';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M142.9 142.9c-17.5 17.5-30.1 38-37.8 59.8c-5.9 16.7-24.2 25.4-40.8 19.5s-25.4-24.2-19.5-40.8C55.6 150.7 73.2 122 97.6 97.6c87.2-87.2 228.3-87.5 315.8-1L455 55c6.9-6.9 17.2-8.9 26.2-5.2s14.8 12.5 14.8 22.2l0 128c0 13.3-10.7 24-24 24l-8.4 0c0 0 0 0 0 0L344 224c-9.7 0-18.5-5.8-22.2-14.8s-1.7-19.3 5.2-26.2l41.1-41.1c-62.6-61.5-163.1-61.2-225.3 1zM16 312c0-13.3 10.7-24 24-24l7.6 0 .7 0L168 288c9.7 0 18.5 5.8 22.2 14.8s1.7 19.3-5.2 26.2l-41.1 41.1c62.6 61.5 163.1 61.2 225.3-1c17.5-17.5 30.1-38 37.8-59.8c5.9-16.7 24.2-25.4 40.8-19.5s25.4 24.2 19.5 40.8c-10.8 30.6-28.4 59.3-52.9 83.8c-87.2 87.2-228.3 87.5-315.8 1L57 457c-6.9 6.9-17.2 8.9-26.2 5.2S16 449.7 16 440l0-119.6 0-.7 0-7.6z"/></svg>
            </button>
            <button class="gizmo-button" id="scaleButton" data-i18n="scale_button" disabled aria-label="Scale mesh size" title="Scale mesh size">
              <!-- <img
                src="./images/scale.svg"                              c
                width="20px"
                height="20px"
                alt="Scale"
                onerror="this.style.display='none'; this.parentNode.textContent='⚏';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32l82.7 0L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3l0 82.7c0 17.7 14.3 32 32 32s32-14.3 32-32l0-160c0-17.7-14.3-32-32-32L320 0zM80 32C35.8 32 0 67.8 0 112L0 432c0 44.2 35.8 80 80 80l320 0c44.2 0 80-35.8 80-80l0-112c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 112c0 8.8-7.2 16-16 16L80 448c-8.8 0-16-7.2-16-16l0-320c0-8.8 7.2-16 16-16l112 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 32z"/></svg>
            </button>
            <!--button class="gizmo-button" id="boundsButton" disabled>
              <img
                src="images/bounds.svg"
                width="20px"
                height="20px"
                alt="bounds"
              />
          </button-->
            <!--button class="gizmo-button" id="focusButton" disabled>
              <img
                src="images/focus.svg"
                width="20px"
                height="20px"
                alt="focus"
              /-->
            </button>
            <button class="gizmo-button" id="hideButton" data-i18n="hide_button" disabled aria-label="Select object" title="Select object">
              <!-- <img
                src="./images/pointer.svg"
                width="20px"
                height="20px"
                alt="Select"
                onerror="this.style.display='none'; this.parentNode.textContent='👆';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M0 55.2L0 426c0 12.2 9.9 22 22 22c6.3 0 12.4-2.7 16.6-7.5L121.2 346l58.1 116.3c7.9 15.8 27.1 22.2 42.9 14.3s22.2-27.1 14.3-42.9L179.8 320l118.1 0c12.2 0 22.1-9.9 22.1-22.1c0-6.3-2.7-12.3-7.4-16.5L38.6 37.9C34.3 34.1 28.9 32 23.2 32C10.4 32 0 42.4 0 55.2z"/></svg>
            </button>
            <button class="gizmo-button" id="duplicateButton" data-i18n="duplicate_button" disabled aria-label="Duplicate mesh" title="Duplicate selected mesh">
              <!-- <img
                src="./images/duplicate.svg"
                width="20px"
                height="20px"
                alt="Duplicate"
                onerror="this.style.display='none'; this.parentNode.textContent='⧉';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"/></svg>
            </button>
            <button class="gizmo-button" id="deleteButton" data-i18n="delete_button" disabled aria-label="Delete mesh" title="Delete selected mesh">
              <!-- <img
                src="./images/delete.svg"
                width="20px"
                height="20px"
                alt="Delete"
                onerror="this.style.display='none'; this.parentNode.textContent='🗑';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z"/></svg>
            </button>
            <button class="gizmo-button" id="cameraButton" data-i18n="camera_button" disabled aria-label="Camera controls" title="Camera controls">
              <!-- <img
                src="./images/camera2.svg"
                width="20px"
                height="20px"
                alt="Camera"
                onerror="this.style.display='none'; this.parentNode.textContent='📷';"
              /> -->
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path fill="white" d="M0 128C0 92.7 28.7 64 64 64l256 0c35.3 0 64 28.7 64 64l0 256c0 35.3-28.7 64-64 64L64 448c-35.3 0-64-28.7-64-64L0 128zM559.1 99.8c10.4 5.6 16.9 16.4 16.9 28.2l0 256c0 11.8-6.5 22.6-16.9 28.2s-23 5-32.9-1.6l-96-64L416 337.1l0-17.1 0-128 0-17.1 14.2-9.5 96-64c9.8-6.5 22.4-7.2 32.9-1.6z"/></svg>
            </button>
          </aside>

          <!---

            <button class="gizmo-button" id="cutButton" disabled>
              <img
                src="images/cut.svg"
                width="20px"
                height="20px"
                alt="cut"
              />
            </button>
            <button class="gizmo-button" id="copyButton" disabled>
              <img
                src="images/copy.svg"
                width="20px"
                height="20px"
                alt="copy"
              />
            </button>
            <button class="gizmo-button" id="pasteButton" disabled>
              <img
                src="images/paste.svg"
                width="20px"
                height="20px"
                alt="paste"
              />
            </button>
          -->

          <!-- Info panel collapse starts -->

          <aside id="info-panel" role="complementary" aria-label="Information panel">
            <details id="info-details">
              <summary data-i18n="keyboard_controls"><strong>Keyboard controls info [&nbsp;Ctrl + /&nbsp;]</strong></summary>

               <div id="info-content" class="content" tabindex="-1" >
                 <table role="table" aria-label="Keyboard shortcuts">
                   <thead class="sr-only">
                     <tr>
                       <th scope="col">Shortcut</th>
                       <th scope="col">Action</th>
                     </tr>
                   </thead>
                   <tbody>
                     <tr>
                       <td>Ctrl + M</td>
                       <td data-i18n="keyboard_menu">Open the main menu</td>
                     </tr>
                     <tr>
                       <td>Ctrl + P</td>
                       <td data-i18n="keyboard_play">Play</td>
                     </tr>
                     <tr>
                       <td>Ctrl + G</td>
                       <td data-i18n="keyboard_gizmos">Go to gizmos</td>
                     </tr>               
                     <tr>
                       <td>Ctrl + L</td>
                       <td data-i18n="keyboard_navigation">Go to browser navigation bar (overridden shortcuts work from here)</td>
                     </tr>
                   </tbody>
                 </table>
                  </div>
            </details>
         
          </aside>

          <footer id="site-footer">
            <nav aria-label="Footer navigation">
              <div id="flocklink">
                <a
                  href="https://flockxr.com/"
                  target="_blank"
                  id="info-panel-link"
                  data-i18n="info_panel_link"
                  
                  aria-label="Visit Flock XR website (opens in new tab)"
                  title="Visit Flock XR website"
                >
                  <img
                    src="./images/inline-flock-xr.svg"
                    alt="Flock XR logo"
                    id="flocklogo"
                  >
                  <span class="sr-only">
                    Visit Flock XR website in a new tab
                  </span>
                </a>
              </div>
            </nav>
          </footer>
        </section>
           <div class="resizer" id="resizer" aria-label="Drag to resize panels" role="separator" aria-orientation="vertical" tabindex="0"></div>
        <section id="codePanel" aria-label="Code editor panel">
          <!--button
            value="Toolbox"
            id="toolboxControl"
            style="
              z-index: 100000;
              font-size: 16px;
              border: none;
              padding: 10px;
              background-color: rgba(255, 101, 80, 0.45);
              box-sizing: border-box;
            "
          >
            <strong>+ Code</strong>
        </button-->
          <div id="blocklyDiv" role="application" aria-label="Visual programming workspace" aria-describedby="blockly-desc" tabindex="0"></div>
          <div id="blockly-desc" class="sr-only">Drag and drop code blocks to create your program. Use arrow keys and Enter to navigate and interact with blocks.</div>
        </section>
      </div>
      </main>
      <div id="bottomBar" role="toolbar" aria-label="View switching controls">
        <button id="switchViews" aria-label="Switch between code and canvas views" aria-describedby="switch-desc">Code >></button>
        <div id="switch-desc" class="sr-only">Toggle between coding view and 3D scene view</div>
      </div>

      <!-- Live region for dynamic announcements -->
      <div id="announcements" aria-live="polite" aria-atomic="true" class="sr-only"></div>
    </div>
    <script type="module" src="/main/main.js"></script>
  </body>
</html>
